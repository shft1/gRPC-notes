syntax = "proto3";

package api.notes.v1;

option go_package = "github.com/shft1/grpc-notes/pkg/api/notes/v1";

import "google/protobuf/timestamp.proto";

import "buf/validate/validate.proto";
import "google/rpc/status.proto";

// NoteIDRequest - сообщение ID заметки
message NoteIDRequest {
  string id = 1 [
    (buf.validate.field).string.uuid = true
  ];
}

// NoteCreateRequest - сообщение заметки для создания
message NoteCreateRequest {
  string title = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 5,
    (buf.validate.field).string.max_len = 25
  ];
  string desc = 2 [
    (buf.validate.field).string.min_len = 10,
    (buf.validate.field).string.max_len = 255
  ];
}

// Note - сообщение заметки
message Note {
  string id = 1 [
    (buf.validate.field).string.uuid = true
  ];
  string title = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 5,
    (buf.validate.field).string.max_len = 25
  ];
  string desc = 3 [
    (buf.validate.field).string.min_len = 10,
    (buf.validate.field).string.max_len = 255
  ];
  bool is_del = 4;
  google.protobuf.Timestamp created_at = 5 [
    (buf.validate.field).required = true
  ];
  google.protobuf.Timestamp updated_at = 6 [
    (buf.validate.field).required = true
  ];
  option (buf.validate.message).cel = {
    id: "time.logic"
    message: "the creation time must be earlier than the update time"
    expression: "this.created_at <= this.updated_at"
  };
}

// NoteList - сообщение списка заметок
message NoteList {
  repeated Note notes = 1 [
    (buf.validate.field).required = true
  ];
}

// NoteEvent - событие заметки
message NoteEvent {
  string id = 1 [
    (buf.validate.field).string.uuid = true
  ];
  string title = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 5,
    (buf.validate.field).string.max_len = 25
  ];
}

// EventResponse - сообщение server-stream
message EventResponse {
  oneof event {
    NoteEvent note = 1;
    Health health = 2;
  }
}

// Health - сообщение об установлении server-stream
message Health {
  string message = 1;
}

// Empty - сообщение на установление server-stream
message Empty {}

// MetricRequest - сообщение client-stream
message MetricRequest {
  int64 number = 1;
}

// SummaryResponse - сообщение по завершении client-stream
message SummaryResponse {
  int64 summary = 1;
}

// Message - сообщение чата
message Message {
  int64 correlation_id = 1;

  oneof payload {
    string text = 2;
    google.rpc.Status error = 3;
  }
}
